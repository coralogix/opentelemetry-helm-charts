---
# Source: opentelemetry-collector/templates/configmap-agent.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: example-opentelemetry-collector-agent
  namespace: default
  labels:
    helm.sh/chart: opentelemetry-collector-0.124.1
    app.kubernetes.io/name: opentelemetry-collector
    app.kubernetes.io/instance: example
    app.kubernetes.io/version: "0.137.0"
    app.kubernetes.io/managed-by: Helm
    
data:
  relay: |
    connectors: {}
    exporters: {}
    extensions:
      opamp:
        agent_description:
          include_resource_attributes: true
          non_identifying_attributes:
            cx.agent.type: agent
            environment: production
            helm.chart.opentelemetry-collector.version: 0.124.1
            team: platform
        server:
          http:
            endpoint: https://ingress.eu2.coralogix.com/opamp/v1
            headers:
              Authorization: Bearer ${env:CORALOGIX_PRIVATE_KEY}
            polling_interval: 2m
    processors:
      transform/test:
        error_mode: silent
        trace_statements:
        - context: span
          statements:
          - set(attributes["http.response.status_code"], attributes["http.status_code"])
            where attributes["http.response.status_code"] == nil
    receivers: {}
    service:
      extensions:
      - opamp
      pipelines: {}
      telemetry:
        logs:
          encoding: json
