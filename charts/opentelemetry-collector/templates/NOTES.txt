{{- if not (eq (toString .Values.extraConfigMapMounts) "<nil>") }}
[WARNING] "extraConfigMapMounts" parameter is deprecated, please use "extraVolumes" or "extraVolumesMounts" instead.
{{ end }}

{{- if not (eq (toString .Values.extraHostPathMounts) "<nil>") }}
[WARNING] "extraHostPathMounts" parameter is deprecated, please use "extraVolumes" or "extraVolumesMounts" instead.
{{ end }}

{{- if not (eq (toString .Values.secretMounts) "<nil>") }}
[WARNING] "secretMounts" parameter is deprecated, please use "extraVolumes" or "extraVolumeMounts" instead.
{{ end }}

{{- if not (eq (toString .Values.extraEnvs) "<nil>") }}
[WARNING] "extraEnvs" parameter is deprecated, please use "extraEnvsMap" instead.
{{ end }}

{{- if not (eq (toString .Values.extraEnvsFrom) "<nil>") }}
[WARNING] "extraEnvsFrom" parameter is deprecated, please use "extraEnvsFromMap" instead.
{{ end }}

{{- if not (eq (toString .Values.extraVolumes) "<nil>") }}
[WARNING] "extraVolumes" parameter is deprecated, please use "extraVolumesMap" instead.
{{ end }}

{{- if not (eq (toString .Values.extraVolumeMounts) "<nil>") }}
[WARNING] "extraVolumeMounts" parameter is deprecated, please use "extraVolumeMountsMap" instead.
{{ end }}

{{- if and (not (eq .Values.mode "daemonset")) (not (eq .Values.mode "deployment")) (not (eq .Values.mode "statefulset")) }}
{{ fail "[ERROR] 'mode' must be set. See https://github.com/open-telemetry/opentelemetry-helm-charts/blob/main/charts/opentelemetry-collector/UPGRADING.md for instructions." }}
{{ end }}

{{- if not .Values.configMap.create }}
[WARNING] "configMap" wil not be created and "config" will not take effect.
{{ end }}

{{- if not (eq (toString .Values.containerLogs) "<nil>") }}
[WARNING] 'containerLogs' is deprecated.  Use 'presets.logsCollection' instead. See https://github.com/open-telemetry/opentelemetry-helm-charts/blob/main/charts/opentelemetry-collector/UPGRADING.md#0231-to-0240 for instructions on how to migrate.
{{ end }}

[INFO] as of chart version 0.47.0 the default collector configuration has been updated to use pod IP instead of 0.0.0.0 for its endpoints. See https://github.com/open-telemetry/opentelemetry-helm-charts/blob/main/charts/opentelemetry-collector/UPGRADING.md#0460-to-0470 for details.

{{- if not .Values.resources }}
[WARNING] As of 0.54.0 Collector chart, the default resource limits are removed. See https://github.com/open-telemetry/opentelemetry-helm-charts/blob/main/charts/opentelemetry-collector/UPGRADING.md#0531-to-0540 for details.
{{ end }}

{{- if .Values.presets.clusterMetrics.enabled }}
{{- if eq .Values.mode "daemonset"}}
{{- fail "Cluster Metrics preset is not suitable for daemonset mode. Please use statefulset or deployment mode with replicaCount: 1"}}
{{ end }}
{{- if gt (int .Values.replicaCount) 1 }}
{{- fail "Cluster Metrics preset is not suitable for replicaCount greater than one. Please change replica count to one." }}
{{ end }}
{{ end }}

{{- if .Values.presets.kubernetesEvents.enabled }}
[WARNING] The 'k8sobjects' is a ALPHA receiver and may be changed anytime.
{{ end }}

{{- if and (eq .Values.mode "daemonset") (eq .Values.service.internalTrafficPolicy "Cluster") }}
[WARNING] Setting internalTrafficPolicy to 'Cluster' on Daemonset is not recommended. Consider using 'Local' instead.
{{ end }}

{{- if and (eq .Values.dnsPolicy "None") (not .Values.dnsConfig) }}
{{- fail "[ERROR] dnsConfig should be provided when dnsPolicy is None" }}
{{ end }}

{{- if .Values.presets.mysql.metrics.enabled }}
{{- $instances := deepCopy .Values.presets.mysql.metrics.instances }}
{{- range $key, $instance := $instances }}
{{- if or (not $instance.username) (not $instance.password) }}
{{- fail "[ERROR] Username and password must be specified for every instance of the MySQL metrics collector" }}
{{ end }}
{{ end }}
{{ end }}

{{- if .Values.presets.mysql.extraLogs.enabled }}
{{- if or (not .Values.presets.mysql.extraLogs.volumeMountName) (not .Values.presets.mysql.extraLogs.mountPath) }}
{{- fail "[ERROR] Volume mount name and mount path must be specified when MySQL extra logs collection is enabled" }}
{{ end }}
[INFO] You have enabled MySQL extra logs collection. In order for the collection to take effect, please annotate your MySQL instance(s) pod templates with the following:

    kubectl patch sts <YOUR_MYSQL_INSTANCE_NAME> -p '{"spec": {"template":{"metadata":{"annotations":{"sidecar.opentelemetry.io/inject":"{{ include "opentelemetry-collector.fullname" . }}-mysql-logs-sidecar"}}}} }'

{{ end }}
